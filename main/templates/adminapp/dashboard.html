{% extends 'shop/base.html' %}

{% block content %}

<h3 class="fw-bold mb-4">Admin Dashboard</h3>

<!-- SUMMARY CARDS -->
<div class="row g-4 mb-5">
  <div class="col-md-3">
    <div class="card shadow-sm border-0 p-3">
      <h6 class="text-muted">Total Users</h6>
      <h3 class="fw-bold">{{ users|length }}</h3>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card shadow-sm border-0 p-3">
      <h6 class="text-muted">Total Products</h6>
      <h3 class="fw-bold">{{ products|length }}</h3>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card shadow-sm border-0 p-3">
      <h6 class="text-muted">Total Orders</h6>
      <h3 class="fw-bold">{{ orders|length }}</h3>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card shadow-sm border-0 p-3">
      <h6 class="text-muted">Total Revenue</h6>
      <h3 class="fw-bold">₹ {{ total_revenue }}</h3>
    </div>
  </div>
</div>
<div class="d-flex justify-content-end mb-4">
  <a href="{% url 'adminapp:admin_products' %}"
     class="btn btn-maroon">
    ✏️ Manage Products
  </a>
</div>


<!-- PRODUCTS & STOCK -->
<div class="card shadow-sm border-0 mb-5">
  <div class="card-body">

    <h5 class="fw-bold mb-3">Products & Stock</h5>

    <div class="table-responsive">
      <table class="table align-middle">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Product</th>
            <th>Price</th>
            <th>Stock</th>
            <th>Update</th>
          </tr>
        </thead>
        <tbody>
          {% for product in products %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ product.name }}</td>
            <td>₹ {{ product.price }}</td>

            <td>
              <form method="post"
                    action="{% url 'adminapp:update_stock' product.id %}"
                    class="d-flex gap-2">
                {% csrf_token %}
                <input type="number"
                       name="stock"
                       value="{{ product.stock }}"
                       min="0"
                       class="form-control form-control-sm"
                       style="width:80px;">
            </td>

            <td>
                <button class="btn btn-sm btn-dark">
                  Update
                </button>
              </form>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-center text-muted">
              No products available
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>

<!-- ORDERS -->
<div class="card shadow-sm border-0">
  <div class="card-body">

    <h5 class="fw-bold mb-3">Recent Orders</h5>

    <div class="table-responsive">
      <table class="table align-middle">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>User</th>
            <th>Product</th>
            <th>Qty</th>
            <th>Price</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          {% for order in orders %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ order.user.username }}</td>
            <td>{{ order.product.name }}</td>
            <td>{{ order.quantity }}</td>
            <td>₹ {{ order.price }}</td>
            <td>{{ order.ordered_at|date:"d M Y" }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted">
              No orders yet
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>

{% endblock %}
